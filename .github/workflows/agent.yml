# Shim workflow â€” copy this file to your target repo at .github/workflows/agent.yml
#
# This is all you need in each repo that uses Remote Dev Bot.
# The real logic lives in gnovak/remote-dev-bot and updates automatically.
#
# Prerequisites (see runbook.md for details):
#   - Repository secrets: at least one LLM API key (ANTHROPIC_API_KEY, OPENAI_API_KEY, or GEMINI_API_KEY)
#   - Actions permissions: read/write + allow PR creation
#
# Note: secrets must be passed explicitly (not via `secrets: inherit`) because
# GitHub Actions does not pass inherited secrets across different repo owners.
#
# To test against a dev branch of remote-dev-bot, change @main to @dev below.

name: Remote Dev Bot

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  resolve:
    # Security gate: only allow trusted users to trigger agent runs.
    # OWNER = repo owner, COLLABORATOR = explicitly invited, MEMBER = org member.
    # This prevents arbitrary users from triggering runs that consume API credits.
    # To restrict further, remove roles from the list (e.g., '["OWNER"]' for owner-only).
    if: >
      (github.event.issue || github.event.pull_request) &&
      startsWith(github.event.comment.body, '/agent-') &&
      contains(fromJson('["OWNER","COLLABORATOR","MEMBER"]'), github.event.comment.author_association)
    uses: gnovak/remote-dev-bot/.github/workflows/resolve.yml@main
    secrets:
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      PAT_TOKEN: ${{ secrets.PAT_TOKEN }}
